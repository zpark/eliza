[1;33mUsing local ElizaOS CLI build: /Users/studio/Documents/GitHub/eliza/packages/cli/shell-tests/../dist/index.js[0m
[1;33melizaos CLI version:[0m
1.0.0-beta.32
[1;33mDiscovering test scripts...[0m
[1;33mNote: Skipping test-dev.sh, test-env-edit.sh, and test-agent-get.sh as they're known to have issues[0m
[1;33mgtimeout not found. Attempting to install coreutils with Homebrew...[0m
==> Downloading https://ghcr.io/v2/homebrew/core/coreutils/manifests/9.7
==> Fetching dependencies for coreutils: gmp
==> Downloading https://ghcr.io/v2/homebrew/core/gmp/manifests/6.3.0
==> Fetching gmp
==> Downloading https://ghcr.io/v2/homebrew/core/gmp/blobs/sha256:6683d73d6677d28e1e8d1b92d6ebfbc068c1d33e19b79114a22a648a99ba5991
==> Fetching coreutils
==> Downloading https://ghcr.io/v2/homebrew/core/coreutils/blobs/sha256:5d3e3c74de367a4d8ae6f22457732a8e5d39030c46f8f585b1780c0a916d0c8e
==> Installing dependencies for coreutils: gmp
==> Installing coreutils dependency: gmp
==> Downloading https://ghcr.io/v2/homebrew/core/gmp/manifests/6.3.0
Already downloaded: /Users/studio/Library/Caches/Homebrew/downloads/70a72a71216843d66a953c06ff6337445ce9bc94fae9f0e301e2f59005274a8e--gmp-6.3.0.bottle_manifest.json
==> Pouring gmp--6.3.0.arm64_sequoia.bottle.tar.gz
ðŸº  /opt/homebrew/Cellar/gmp/6.3.0: 22 files, 3.3MB
==> Installing coreutils
==> Pouring coreutils--9.7.arm64_sequoia.bottle.tar.gz
==> Caveats
Commands also provided by macOS and the commands dir, dircolors, vdir have been installed with the prefix "g".
If you need to use these commands with their normal names, you can add a "gnubin" directory to your PATH with:
  PATH="/opt/homebrew/opt/coreutils/libexec/gnubin:$PATH"
==> Summary
ðŸº  /opt/homebrew/Cellar/coreutils/9.7: 465 files, 11.8MB
==> Running `brew cleanup coreutils`...
Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.
Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).
==> Caveats
==> coreutils
Commands also provided by macOS and the commands dir, dircolors, vdir have been installed with the prefix "g".
If you need to use these commands with their normal names, you can add a "gnubin" directory to your PATH with:
  PATH="/opt/homebrew/opt/coreutils/libexec/gnubin:$PATH"
[1;33m[Abort on Failure] Running all shell tests...[0m
[1;33mRunning test scripts...[0m
[1;33mRunning simplified-test.sh...[0m
Using provided ELIZAOS_CMD: node --no-inspect /Users/studio/Documents/GitHub/eliza/packages/cli/shell-tests/../dist/index.js
Creating test directory: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-simplified-test-XXXXXXXX.4oODjgirxZ
Clearing ~/.eliza directory for clean state...
--- Testing project creation ---
DEBUG: opts.yes = true, typeof = boolean
DEBUG: process.argv = /Users/studio/.nvm/versions/node/v18.20.7/bin/node /Users/studio/Documents/GitHub/eliza/packages/cli/dist/index.js create myproject -t project -y
DEBUG: Skipping banner (non-interactive mode)
Using default database: pglite
[2025-04-14 22:06:43] INFO: [36mCopying project template from /Users/studio/Documents/GitHub/eliza/packages/cli/templates/project-starter to /private/var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-simplified-test-XXXXXXXX.4oODjgirxZ/myproject[39m
[2025-04-14 22:06:43] INFO: [36mSetting @elizaos/cli to use latest version dynamically[39m
[2025-04-14 22:06:43] INFO: [36mSetting @elizaos/core to use latest version dynamically[39m
[2025-04-14 22:06:43] INFO: [36mSetting @elizaos/plugin-anthropic to use latest version dynamically[39m
[2025-04-14 22:06:43] INFO: [36mSetting @elizaos/plugin-openai to use latest version dynamically[39m
[2025-04-14 22:06:43] INFO: [36mSetting @elizaos/plugin-sql to use latest version dynamically[39m
[2025-04-14 22:06:43] SUCCESS: [36mUpdated package.json with project name and latest dependencies[39m
[2025-04-14 22:06:43] SUCCESS: [36mproject template copied successfully[39m
[2025-04-14 22:06:43] INFO: [36mCreated PGLite database directory: /Users/studio/.eliza/db[39m
[2025-04-14 22:06:43] SUCCESS: [36mPGLite configuration saved[39m
Using PGLite database directory: /Users/studio/.eliza/db
Installing dependencies...
[0m[1mbun install [0m[2mv1.2.5 (013fdddc)[0m

[0m[32m+[0m [1m@vitest/coverage-v8[0m[2m@2.1.5[0m
[0m[32m+[0m [1mprettier[0m[2m@3.5.3[0m
[0m[32m+[0m [1mtsup[0m[2m@8.4.0[0m
[0m[32m+[0m [1mvitest[0m[2m@2.1.5[0m
[0m[32m+[0m [1m@elizaos/cli[0m[2m@1.0.0-beta.32[0m
[0m[32m+[0m [1m@elizaos/core[0m[2m@1.0.0-beta.32[0m
[0m[32m+[0m [1m@elizaos/plugin-anthropic[0m[2m@1.0.0-beta.32[0m
[0m[32m+[0m [1m@elizaos/plugin-openai[0m[2m@1.0.0-beta.32[0m
[0m[32m+[0m [1m@elizaos/plugin-sql[0m[2m@1.0.0-beta.32[0m
[0m[32m+[0m [1mzod[0m[2m@3.24.2[0m

[32m422[0m packages[0m installed [0m[2m[[1m13.05s[0m[2m][0m

[2mBlocked 1 postinstall. Run `bun pm untrusted` for details.[0m
Installed base dependencies
Skipping build in non-interactive mode
Project initialized successfully!

Your project is ready! Here's what you can do next:
1. `cd myproject` to change into your project directory
2. Run `npx elizaos start` to start your project
3. Visit `http://localhost:3000` (or your custom port) to view your project in the browser
]1337;CurrentDir=/private/var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-simplified-test-XXXXXXXX.4oODjgirxZ/myprojectProject create return code: 0
  âœ… Create project with -y flag
  âœ… Project directory created successfully
  âœ… Project has sufficient files (   15202)
--- Testing plugin creation ---
DEBUG: opts.yes = true, typeof = boolean
DEBUG: process.argv = /Users/studio/.nvm/versions/node/v18.20.7/bin/node /Users/studio/Documents/GitHub/eliza/packages/cli/dist/index.js create myplugin -t plugin -y
DEBUG: Skipping banner (non-interactive mode)
Note: Using "plugin-myplugin" as the directory name to match package naming convention
[2025-04-14 22:06:56] INFO: [36mCopying plugin template from /Users/studio/Documents/GitHub/eliza/packages/cli/templates/plugin-starter to /private/var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-simplified-test-XXXXXXXX.4oODjgirxZ/plugin-myplugin[39m
[2025-04-14 22:06:56] INFO: [36mSetting @elizaos/cli to use latest version dynamically[39m
[2025-04-14 22:06:56] INFO: [36mSetting @elizaos/core to use latest version dynamically[39m
[2025-04-14 22:06:56] SUCCESS: [36mUpdated plugin name in index.ts to plugin-myplugin[39m
[2025-04-14 22:06:56] SUCCESS: [36mUpdated package.json with project name and latest dependencies[39m
Installing dependencies...
[2025-04-14 22:06:56] SUCCESS: [36mplugin template copied successfully[39m
[0m[1mbun install [0m[2mv1.2.5 (013fdddc)[0m

[0m[32m+[0m [1mprettier[0m[2m@3.5.3[0m
[0m[32m+[0m [1mtsup[0m[2m@8.4.0[0m
[0m[32m+[0m [1mtypescript[0m[2m@5.8.2[0m
[0m[32m+[0m [1m@elizaos/cli[0m[2m@1.0.0-beta.32[0m
[0m[32m+[0m [1m@elizaos/core[0m[2m@1.0.0-beta.32[0m
[0m[32m+[0m [1mzod[0m[2m@3.24.2[0m

[32m266[0m packages[0m installed [0m[2m[[1m635.00ms[0m[2m][0m[0m
Dependencies installed successfully!
Skipping build in non-interactive mode
Plugin initialized successfully!

Your plugin is ready! Here's your development workflow:

[1] Development
   cd plugin-myplugin
   [36mnpx elizaos dev[39m              # Start development with hot-reloading

[2] Testing
   [36mnpx elizaos test[39m             # Run automated tests
   [36mnpx elizaos start[39m            # Test in a live agent environment

[3] Publishing
   [36mnpx elizaos plugin publish --test[39m    # Check registry requirements
   [36mnpx elizaos plugin publish[39m           # Submit to registry

[?] Learn more: https://eliza.how/docs/cli/plugins
]1337;CurrentDir=/private/var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-simplified-test-XXXXXXXX.4oODjgirxZ/plugin-mypluginPlugin create return code: 0
  âœ… Create plugin with -y flag
  âœ… Plugin directory created successfully
  âœ… Plugin has sufficient files (    9067)
--- Test complete: 6 passed, 0 failed ---
Removing test directory: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-simplified-test-XXXXXXXX.4oODjgirxZ
[0;32mPASS: simplified-test.sh[0m
[1;33mRunning test-agent-list.sh...[0m
Running tests in /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-list-test-XXXXXXXX.hTNgjoFj7d
Using PGLite database directory: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-list-test-XXXXXXXX.hTNgjoFj7d/db (POSTGRES_URL empty)
Using OPENAI_API_KEY=sk-t...
Starting ElizaOS server in background...
ElizaOS server started with PID 4931. Log: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-list-test-XXXXXXXX.hTNgjoFj7d/elizaos_server.log
Waiting for server to respond...
Server responded after 0 seconds.
Attempting to start a default agent (Eliza)...
Agent start attempt 1 of 3
Agent 'eliza' started successfully.
Agent 'eliza' started successfully. Waiting for registration...
Test: elizaos agent list (basic command)
  âœ– agent list command executes (exit 1)
--- STDOUT/STDERR ---
[2025-04-14 22:07:10] SUCCESS: [36mElizaOS server is running[39m
[2025-04-14 22:07:10] ERROR: [36mAn error occurred:[39m
    message: "(Error) Failed to fetch agents list: Internal Server Error"
    stack: [
      "Error: Failed to fetch agents list: Internal Server Error",
      "at getAgents (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/chunk-7ZBF7PEY.js:218:11)",
      "at process.processTicksAndRejections (node:internal/process/task_queues:95:5)",
      "at async _Command.<anonymous> (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/chunk-7ZBF7PEY.js:242:20)",
      "at async _Command.parseAsync (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/chunk-5LH7NKB4.js:1721:9)",
      "at async main (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/index.js:115:3)"
    ]
[2025-04-14 22:07:10] ERROR: [36mError details: Failed to fetch agents list: Internal Server Error[39m
[2025-04-14 22:07:10] ERROR: [36mStack trace: Error: Failed to fetch agents list: Internal Server Error
    at getAgents (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/chunk-7ZBF7PEY.js:218:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async _Command.<anonymous> (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/chunk-7ZBF7PEY.js:242:20)
    at async _Command.parseAsync (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/chunk-5LH7NKB4.js:1721:9)
    at async main (file:///Users/studio/.nvm/versions/node/v18.20.7/lib/node_modules/@elizaos/cli/dist/index.js:115:3)[39m
---------------------
  âœ” output contains agent name 'eliza'
  âœ– output missing header text
Test: elizaos agent ls (alias command)
  âœ” agent ls alias works
Test: elizaos agent list -j (JSON output)
  âœ” agent list with -j flag
  âœ– Output is not valid JSON
Debugger listening on ws://127.0.0.1:59319/9af3e9e0-605a-420d-a1ea-56e2249b47e5
For help, see: https://nodejs.org/en/docs/inspector
Debugger attached.
âœ– Invalid JSON: Unexpected number in JSON at position 5
Waiting for the debugger to disconnect...
elizaos agent list tests complete: 3 passed, 3 failed
Cleaning up...
ElizaOS server (PID 4931) already stopped.
Test failed. Preserving test directory: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-list-test-XXXXXXXX.hTNgjoFj7d
[0;32mPASS: test-agent-list.sh[0m
[1;33mRunning test-agent-restart.sh...[0m
Running tests in /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-restart-test-XXXXXXXX.9m8kmG0MmM
Using PGLite database directory: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-restart-test-XXXXXXXX.9m8kmG0MmM/db (POSTGRES_URL empty)
Using OPENAI_API_KEY=test...
Starting ElizaOS server in background...
ElizaOS server started with PID 4957. Log: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-restart-test-XXXXXXXX.9m8kmG0MmM/elizaos_server.log
Waiting for server to respond...
Server responded after 0 seconds.
Setup: Starting agents...
  âœ” Agent 'agent1' started.
  âœ” Agent 'agent2' started.
Test: elizaos agent restart (invalid agent name)
  âœ” agent get with invalid agent name 'invalid-agent-does-not-exist'
  âœ” error output for invalid agent
elizaos agent restart tests complete: 2 passed, 0 failed
Cleaning up...
ElizaOS server (PID 4957) already stopped.
Removing test directory /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-restart-test-XXXXXXXX.9m8kmG0MmM...
Warning: Could not cd back to original directory /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-restart-test-XXXXXXXX.9m8kmG0MmM
[0;32mPASS: test-agent-restart.sh[0m
[1;33mRunning test-agent-start.sh...[0m
Running tests in /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-start-test-XXXXXXXX.OZofd3DAGa
Using PGLite database directory: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-start-test-XXXXXXXX.OZofd3DAGa/db (POSTGRES_URL empty)
Using OPENAI_API_KEY=test...
Starting ElizaOS server in background...
ElizaOS server started with PID 4972. Log: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-start-test-XXXXXXXX.OZofd3DAGa/elizaos_server.log
Waiting for server to respond...
Server responded after 0 seconds.
Test: elizaos agent start (default character)
  âœ” agent start (with explicit default JSON)
  âœ– agent 'default' not found in list after start
Test: elizaos agent s (alias, default character)
  âœ” agent s (alias, with explicit default JSON)
  âœ– agent 'default' not found in list after start alias (or possible name collision)
[]
Test: elizaos agent start -j <json>
  âœ” agent start with -j
  âœ– agent 'agent-json' not found in list after start
Test: elizaos agent start --path <path>
  âœ” agent start with --path config.json
--- Current agent list (after successful start) ---

Available agents:
No agents found
-------------------------
  âœ” agent 'agent-path' not found in list despite successful start
Warning: Failed to stop agent agent-path (might not have started)
Test: elizaos agent start -j (invalid JSON string)
  âœ” agent start with invalid JSON string
  âœ” error output for invalid JSON string
Test: elizaos agent start (invalid path)
  âœ” agent start with invalid path
  âœ” Correctly failed due to invalid file path
Test: elizaos agent start -j (invalid config content - missing name)
  âœ” agent start with invalid config content (missing name)
  âœ” Correctly failed due to invalid config content
Test: elizaos agent start --path <test-character-generated>
  Creating a minimal character file directly...
DEBUG: Checking server status before starting shaw...
ERROR: Server seems unresponsive (exit code 1) before starting shaw test! Dumping server log tail:
    agentName: "Eliza"
    agentId: "b850bc30-45f8-0041-a00a-83df46d8555d"
[2025-04-14 22:07:19] DEBUG: [36mEliza(b850bc30-45f8-0041-a00a-83df46d8555d) - Registering service: task[39m
    agentName: "Eliza"
    agentId: "b850bc30-45f8-0041-a00a-83df46d8555d"
[2025-04-14 22:07:19] DEBUG: [36mEliza(b850bc30-45f8-0041-a00a-83df46d8555d) - Service task registered successfully[39m
    agentName: "Eliza"
    agentId: "b850bc30-45f8-0041-a00a-83df46d8555d"
[2025-04-14 22:07:19] DEBUG: [36mEliza(b850bc30-45f8-0041-a00a-83df46d8555d) - Registering service: scenario[39m
    agentName: "Eliza"
    agentId: "b850bc30-45f8-0041-a00a-83df46d8555d"
[2025-04-14 22:07:19] DEBUG: [36mEliza(b850bc30-45f8-0041-a00a-83df46d8555d) - Service scenario registered successfully[39m
    agentName: "Eliza"
    agentId: "b850bc30-45f8-0041-a00a-83df46d8555d"
[2025-04-14 22:07:19] DEBUG: [36mRegistering agent: b850bc30-45f8-0041-a00a-83df46d8555d (Eliza)[39m
[2025-04-14 22:07:19] DEBUG: [36mAgent b850bc30-45f8-0041-a00a-83df46d8555d added to agents map[39m
[2025-04-14 22:07:19] DEBUG: [36mRegistered reply action for agent b850bc30-45f8-0041-a00a-83df46d8555d[39m
[2025-04-14 22:07:19] DEBUG: [36mRegistering 0 custom routes for agent b850bc30-45f8-0041-a00a-83df46d8555d[39m
[2025-04-14 22:07:19] SUCCESS: [36mSuccessfully registered agent b850bc30-45f8-0041-a00a-83df46d8555d (Eliza)[39m
[2025-04-14 22:07:19] LOG: [36mStarted Eliza as b850bc30-45f8-0041-a00a-83df46d8555d[39m
  âœ” agent start with minimal test character
--- Current agent list (after successful character start) ---

Available agents:
No agents found
-------------------------
  âœ” agent 'Shaw' not found in list despite successful character start
Warning: Failed to stop agent Shaw
Test: elizaos agent start (duplicate name)
  âœ” agent start with duplicate name (agent-json) (expecting success for now)
  Skipping duplicate name error check due to current server behavior.
elizaos agent start tests complete: 14 passed, 3 failed
With 3 failures, the test is considered failed
Cleaning up...
Stopping ElizaOS server (PID 4972)...
Test failed. Preserving test directory: /var/folders/73/8d8pd5w56mvc4y22q4n0wv6c0000gn/T/elizaos-agent-start-test-XXXXXXXX.OZofd3DAGa
